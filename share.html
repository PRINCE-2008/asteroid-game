<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WiFi Drop - Simple</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PeerJS -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <!-- QRious -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', system-ui, sans-serif; touch-action: manipulation; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-active { color: #60a5fa; background: rgba(51, 65, 85, 0.5); border-top: 2px solid #60a5fa; }
        .tab-inactive { color: #94a3b8; border-top: 2px solid transparent; }
        .modal-enter { animation: modalIn 0.2s ease-out forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .toast-enter { animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .toast-exit { animation: slideOut 0.3s ease-in forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translate(-50%, -20px); } to { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes slideOut { from { opacity: 1; transform: translate(-50%, 0); } to { opacity: 0; transform: translate(-50%, -20px); } }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden bg-slate-900">

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-6 left-1/2 z-[150] flex flex-col gap-2 w-max max-w-[90%] pointer-events-none"></div>

    <!-- Connection Modal -->
    <div id="request-modal" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-slate-800 border border-slate-600 rounded-2xl p-6 max-w-xs w-full shadow-2xl modal-enter text-center">
            <div class="w-14 h-14 bg-blue-500/20 text-blue-400 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/30">
                <i class="fa-solid fa-link text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-1">Incoming Connection</h3>
            <p class="text-slate-400 text-xs mb-6">
                <span id="request-id" class="font-mono text-white bg-slate-700 px-1.5 py-0.5 rounded">Device</span> wants to connect.
            </p>
            <div class="flex gap-3">
                <button onclick="respondToRequest(false)" class="flex-1 py-2.5 rounded-xl border border-slate-600 text-slate-300 hover:bg-slate-700 text-xs font-bold transition">Decline</button>
                <button onclick="respondToRequest(true)" class="flex-1 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold shadow-lg shadow-blue-900/30 transition">Accept</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <nav class="h-16 border-b border-gray-800 bg-slate-900/90 backdrop-blur-md flex justify-between items-center px-4 z-20 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-900/20 text-white">
                <i class="fa-solid fa-wifi"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none text-white tracking-tight">WiFi<span class="text-blue-500">Drop</span></h1>
                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-0.5">Simple P2P</p>
            </div>
        </div>
        <div id="status-pill" class="px-3 py-1.5 rounded-full text-[10px] font-bold bg-slate-800 border border-slate-700 text-slate-400 flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-slate-600"></div>
            <span id="status-text">Offline</span>
        </div>
    </nav>

    <!-- Content Layout -->
    <div class="flex-1 flex flex-col md:flex-row relative overflow-hidden min-h-0">
        
        <!-- Left Panel: My ID & Connect -->
        <div id="left-panel" class="w-full md:w-[320px] lg:w-[360px] bg-slate-900 border-r border-gray-800 flex flex-col h-full overflow-y-auto z-10 pb-20 md:pb-0">
            <div class="p-4 space-y-4">
                
                <!-- My ID Card -->
                <div class="glass p-4 rounded-2xl">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">My Identity</label>
                        <button onclick="toggleQR()" class="text-blue-400 hover:text-white text-xs transition"><i class="fa-solid fa-qrcode mr-1"></i> QR</button>
                    </div>
                    
                    <div class="flex items-center gap-2 bg-slate-950 p-2 rounded-xl border border-gray-700 mb-3">
                        <!-- Editable Input -->
                        <input id="my-id-input" type="text" class="bg-transparent text-white font-mono text-xs w-full outline-none" placeholder="Loading...">
                        <button onclick="setCustomId()" class="text-xs bg-slate-800 hover:bg-slate-700 text-white px-2 py-1 rounded border border-slate-600 transition">Set</button>
                        <button onclick="copyId()" class="text-gray-500 hover:text-white p-1 ml-1" title="Copy"><i class="fa-regular fa-copy"></i></button>
                    </div>

                    <div id="qr-container" class="hidden bg-white p-3 rounded-xl mx-auto w-max mb-3">
                         <canvas id="qr-code" class="w-32 h-32"></canvas>
                    </div>
                    
                    <p class="text-[10px] text-gray-500 text-center">Share this ID with your partner.</p>
                </div>

                <!-- Manual Connect -->
                <div class="glass p-4 rounded-2xl">
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-wider block mb-3">Connect to Partner</label>
                    <div class="flex gap-2">
                        <input type="text" id="remote-id" placeholder="Enter Partner's ID" class="w-full bg-slate-950 border border-gray-700 rounded-xl px-3 py-2.5 text-xs text-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition">
                        <button onclick="initiateConnection(document.getElementById('remote-id').value)" class="bg-blue-600 hover:bg-blue-500 text-white w-10 rounded-xl flex items-center justify-center shadow-lg transition">
                            <i class="fa-solid fa-arrow-right text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Chat & Files -->
        <div id="right-panel" class="w-full flex-1 bg-slate-950 relative flex flex-col h-full hidden md:flex min-h-0">
            
            <!-- Drag Drop Zone -->
            <div id="drop-zone" class="absolute inset-0 bg-blue-600/20 z-50 hidden backdrop-blur-sm flex items-center justify-center border-4 border-blue-500/50 border-dashed m-4 rounded-3xl transition-all">
                <div class="text-center pointer-events-none animate-bounce">
                    <i class="fa-solid fa-file-arrow-up text-5xl text-blue-400 mb-2"></i>
                    <h2 class="text-xl font-bold text-white">Drop to Send</h2>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="waiting-screen" class="hidden absolute inset-0 bg-slate-950/95 z-40 flex flex-col items-center justify-center text-center p-6 backdrop-blur-sm">
                <div class="w-12 h-12 border-4 border-slate-700 border-t-blue-500 rounded-full animate-spin mb-4"></div>
                <h3 class="text-lg font-bold text-white mb-1">Connecting...</h3>
                <p class="text-slate-400 text-xs mb-4">Please wait up to 15 seconds.</p>
                <button onclick="cancelConnection()" class="text-red-400 text-xs hover:text-red-300">Cancel</button>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-gray-500 p-8">
                <div class="w-20 h-20 bg-slate-900 rounded-3xl flex items-center justify-center mb-4 border border-slate-800 shadow-xl">
                    <i class="fa-solid fa-plug text-3xl text-slate-700"></i>
                </div>
                <p class="text-sm">Enter an ID to connect.</p>
            </div>

            <!-- File List -->
            <div id="file-list" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-3 hidden no-scrollbar pb-24 md:pb-6"></div>

            <!-- Input Bar -->
            <div class="p-4 bg-slate-900 border-t border-gray-800 hidden shrink-0" id="action-bar">
                <input type="file" id="file-input" class="hidden" onchange="handleFiles(this.files)">
                
                <button id="send-btn" onclick="triggerFileSelect()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-blue-900/20 flex items-center justify-center gap-2 active:scale-[0.98] transition-all">
                    <i class="fa-solid fa-plus"></i> Send File
                </button>
                
                <div id="progress-container" class="hidden w-full flex items-center gap-3 bg-slate-800 p-3 rounded-xl border border-gray-700">
                    <div class="flex-1">
                        <div class="flex justify-between text-[10px] mb-1.5 uppercase font-bold tracking-wider text-gray-400">
                            <span id="progress-text">Sending...</span>
                            <span id="progress-percent" class="text-white">0%</span>
                        </div>
                        <div class="h-1.5 bg-slate-950 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-150"></div>
                        </div>
                    </div>
                    <button onclick="cancelTransfer()" class="text-gray-400 hover:text-red-400 p-2"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <!-- Bottom spacer for mobile nav -->
                <div class="h-14 md:hidden"></div>
            </div>
        </div>
    </div>

    <!-- Mobile Nav -->
    <div class="md:hidden fixed bottom-0 w-full bg-slate-900/95 backdrop-blur-lg border-t border-gray-800 flex h-16 z-50">
        <button onclick="switchTab('conn')" id="tab-conn" class="flex-1 flex flex-col items-center justify-center tab-active transition-colors">
            <i class="fa-solid fa-user-group text-lg mb-1"></i>
            <span class="text-[10px] font-bold tracking-wide mt-1">Connect</span>
        </button>
        <button onclick="switchTab('files')" id="tab-files" class="flex-1 flex flex-col items-center justify-center tab-inactive transition-colors relative">
            <i class="fa-solid fa-file-export text-lg mb-1"></i>
            <span class="text-[10px] font-bold tracking-wide mt-1">Transfer</span>
            <div id="file-notify" class="hidden absolute top-4 right-[30%] w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
        </button>
    </div>

    <script>
        // --- CONFIGURATION ---
        const CHUNK_SIZE = 64 * 1024; // 64KB for compatibility
        const BUFFER_THRESHOLD = 1024 * 1024; // 1MB buffer limit

        let peer;
        let conn;
        let myId = null;
        let activeTransfer = null;
        let connectionRequest = null;

        const els = {
            qrCanvas: document.getElementById('qr-code'),
            myId: document.getElementById('my-id-input'), 
            emptyState: document.getElementById('empty-state'),
            fileList: document.getElementById('file-list'),
            actionBar: document.getElementById('action-bar'),
            statusPill: document.getElementById('status-pill'),
            statusText: document.getElementById('status-text'),
            dropZone: document.getElementById('drop-zone'),
            progressBox: document.getElementById('progress-container'),
            progressBar: document.getElementById('progress-bar'),
            progressText: document.getElementById('progress-text'),
            progressPercent: document.getElementById('progress-percent'),
            sendBtn: document.getElementById('send-btn'),
            requestModal: document.getElementById('request-modal'),
            requestIdDisplay: document.getElementById('request-id'),
            waitingScreen: document.getElementById('waiting-screen'),
            leftPanel: document.getElementById('left-panel'),
            rightPanel: document.getElementById('right-panel'),
            tabConn: document.getElementById('tab-conn'),
            tabFiles: document.getElementById('tab-files'),
            fileNotify: document.getElementById('file-notify'),
            qrContainer: document.getElementById('qr-container'),
            toastContainer: document.getElementById('toast-container')
        };

        // --- Utilities ---
        function showToast(msg, type = 'info') {
            const toast = document.createElement('div');
            const bg = type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-green-600' : 'bg-slate-700');
            toast.className = `${bg} text-white px-4 py-3 rounded-xl shadow-xl text-xs font-bold flex items-center gap-2 backdrop-blur-md pointer-events-auto toast-enter transform -translate-x-1/2`;
            toast.innerHTML = `<span>${msg}</span>`;
            els.toastContainer.appendChild(toast);
            setTimeout(() => { toast.classList.remove('toast-enter'); toast.classList.add('toast-exit'); setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function updateStatus(text, color) {
            els.statusText.textContent = text;
            const dot = els.statusPill.querySelector('div');
            dot.className = `w-2 h-2 rounded-full ${color === 'green' ? 'bg-green-500' : (color === 'yellow' ? 'bg-yellow-500' : 'bg-slate-500')}`;
            els.statusPill.className = `px-3 py-1.5 rounded-full text-[10px] font-bold border flex items-center gap-2 transition-all ${color === 'green' ? 'bg-green-900/30 border-green-500/30 text-green-400' : 'bg-slate-800 border-slate-700 text-slate-400'}`;
        }

        function switchTab(tab) {
            if (tab === 'conn') {
                els.leftPanel.classList.remove('hidden');
                els.rightPanel.classList.add('hidden');
                els.tabConn.className = "flex-1 flex flex-col items-center justify-center tab-active";
                els.tabFiles.className = "flex-1 flex flex-col items-center justify-center tab-inactive";
            } else {
                els.leftPanel.classList.add('hidden');
                els.rightPanel.classList.remove('hidden');
                els.rightPanel.classList.add('flex');
                els.tabConn.className = "flex-1 flex flex-col items-center justify-center tab-inactive";
                els.tabFiles.className = "flex-1 flex flex-col items-center justify-center tab-active";
                els.fileNotify.classList.add('hidden');
            }
        }

        function triggerFileSelect() {
            if (!conn || !conn.open) {
                showToast("Connect to a device first", "error");
                if (window.innerWidth < 768) switchTab('conn');
                return;
            }
            document.getElementById('file-input').click();
        }

        // --- Initialization ---
        window.addEventListener('load', () => {
            initPeer();
            setupDragDrop();
        });

        function initPeer(customId = null) {
            if (peer) peer.destroy();
            
            // Random ID if no custom one provided
            const peerId = customId || `user-${Math.floor(Math.random()*10000)}`;
            
            const options = {
                debug: 1, 
                secure: true,
                config: { 
                    iceServers: [
                        { urls: 'stun:stun1.l.google.com:19302' }, 
                        { urls: 'stun:global.stun.twilio.com:3478' }
                    ] 
                }
            };

            peer = new Peer(peerId, options);

            peer.on('open', (id) => {
                myId = id;
                els.myId.value = id;
                generateQR();
                updateStatus("Online", "green");
                showToast("Network Ready", "success");
            });

            peer.on('error', (err) => {
                if (err.type === 'unavailable-id') {
                    showToast("ID Taken. Try another.", "error");
                } else if (err.type === 'peer-unavailable') {
                    // Do nothing here, handled in initiateConnection
                } else if (err.type === 'disconnected' || err.type === 'network' || err.message.includes('Lost connection')) {
                    updateStatus("Reconnecting...", "yellow");
                    if(peer && !peer.destroyed) peer.reconnect();
                } else {
                    console.log("Peer Error: " + err.type);
                }
            });

            peer.on('connection', setupConnection);
        }

        function setCustomId() {
            const newId = els.myId.value.trim();
            if(!newId) return;
            if(newId !== myId) {
                initPeer(newId);
            }
        }

        // --- Connection Logic ---
        function initiateConnection(id) {
            if (!id || id === myId) return;
            if (window.innerWidth < 768) switchTab('files');
            
            els.waitingScreen.classList.remove('hidden');
            els.emptyState.classList.add('hidden');
            
            if(conn) conn.close();
            
            // Long timeout for slow networks
            setTimeout(() => {
                if(!conn || !conn.open) {
                    els.waitingScreen.classList.add('hidden');
                    if (!conn) showToast("Connection Timeout. Check ID.", "error");
                }
            }, 15000);

            try {
                conn = peer.connect(id, { reliable: true });
                setupConnection(conn);
            } catch(e) { showToast("Error initializing connection", "error"); }
        }

        function setupConnection(c) {
            c.on('open', () => {
                // If we initiated, send request
                if (c.peer === conn?.peer && !els.waitingScreen.classList.contains('hidden')) {
                    c.send({ type: 'connection-request', from: myId });
                }
            });

            c.on('data', (data) => {
                if (data.type === 'connection-request') {
                    connectionRequest = { conn: c, id: data.from };
                    document.getElementById('request-id').textContent = data.from;
                    els.requestModal.classList.remove('hidden');
                } else if (data.type === 'connection-accepted') {
                    connectionAuthorized(c);
                } else if (data.type === 'connection-rejected') {
                    showToast("Connection Denied", "error");
                    resetUI();
                } else {
                    handleIncomingData(data);
                }
            });

            c.on('close', () => { 
                resetUI(); 
                showToast("Disconnected", "error"); 
                updateStatus("Online", "green"); // Revert status
            });
            
            c.on('error', (err) => {
                console.error("Conn Error", err);
                resetUI();
                showToast("Connection Error", "error");
            });

            conn = c; 
        }

        function respondToRequest(accepted) {
            els.requestModal.classList.add('hidden');
            if (!connectionRequest) return;
            if (accepted) {
                connectionRequest.conn.send({ type: 'connection-accepted' });
                connectionAuthorized(connectionRequest.conn);
            } else {
                connectionRequest.conn.send({ type: 'connection-rejected' });
                connectionRequest.conn.close();
            }
            connectionRequest = null;
        }

        function connectionAuthorized(c) {
            conn = c;
            els.waitingScreen.classList.add('hidden');
            els.emptyState.classList.add('hidden');
            els.fileList.classList.remove('hidden');
            els.actionBar.classList.remove('hidden');
            updateStatus("Connected", "green");
            showToast("Connected Successfully!", "success");
            if (window.innerWidth < 768) switchTab('files');
        }

        function cancelConnection() {
            if(conn) conn.close();
            resetUI();
        }

        // --- File Transfer ---
        async function handleFiles(files) {
            if (!files.length) return;
            if (activeTransfer) return showToast("Busy", "error");
            
            const file = files[0];
            activeTransfer = { type: 'sender', cancelled: false };
            els.sendBtn.classList.add('hidden');
            els.progressBox.classList.remove('hidden');
            
            conn.send({ type: 'meta', name: file.name, size: file.size, mime: file.type });
            addFileBubble(file.name, file.size, 'sent', null);
            
            const reader = new FileReader();
            let offset = 0;
            const wait = ms => new Promise(res => setTimeout(res, ms));

            const readSlice = async () => {
                if (activeTransfer.cancelled) { resetTransferUI(); return; }
                
                // Stable Backpressure
                if (conn.dataChannel.bufferedAmount > BUFFER_THRESHOLD) { 
                    await wait(50); 
                    readSlice(); 
                    return; 
                }

                const slice = file.slice(offset, offset + CHUNK_SIZE);
                reader.readAsArrayBuffer(slice);
            };

            reader.onload = (e) => {
                if(!conn || !conn.open || activeTransfer.cancelled) return;
                try { conn.send(e.target.result); } catch(err) { cancelTransfer(); return; }
                
                offset += e.target.result.byteLength;
                const pct = Math.round((offset / file.size) * 100);
                els.progressBar.style.width = pct + '%';
                els.progressPercent.textContent = pct + '%';
                
                if (offset < file.size) {
                    readSlice();
                } else {
                    resetTransferUI(); 
                    showToast("Sent Successfully", "success");
                }
            };
            readSlice();
        }

        let incoming = null;
        function handleIncomingData(data) {
            if (data.type === 'cancel') { resetTransferUI(); showToast("Cancelled", "error"); return; }
            if (data.type === 'meta') {
                activeTransfer = { type: 'receiver', cancelled: false };
                incoming = { name: data.name, size: data.size, mime: data.mime, buffer: [], received: 0 };
                els.sendBtn.classList.add('hidden');
                els.progressBox.classList.remove('hidden');
                els.progressText.textContent = `Receiving ${data.name.substr(0,10)}...`;
                if (window.innerWidth < 768) els.fileNotify.classList.remove('hidden');
                return;
            }
            if (incoming) {
                if(activeTransfer.cancelled) return;
                incoming.buffer.push(data);
                incoming.received += data.byteLength;
                
                const pct = Math.round((incoming.received / incoming.size) * 100);
                els.progressBar.style.width = pct + '%';
                els.progressPercent.textContent = pct + '%';

                if (incoming.received >= incoming.size) {
                    const blob = new Blob(incoming.buffer, { type: incoming.mime });
                    const url = URL.createObjectURL(blob);
                    addFileBubble(incoming.name, incoming.size, 'received', url);
                    resetTransferUI();
                    incoming = null;
                    showToast("File Received", "success");
                }
            }
        }

        function cancelTransfer() {
            if(activeTransfer) {
                activeTransfer.cancelled = true;
                conn.send({ type: 'cancel' });
            }
            resetTransferUI();
        }

        function resetTransferUI() {
            activeTransfer = null;
            els.progressBox.classList.add('hidden');
            els.sendBtn.classList.remove('hidden');
            els.progressBar.style.width = '0%';
            document.getElementById('file-input').value = '';
        }

        // --- Helpers ---
        function generateQR() {
            const baseUrl = window.location.href.split('?')[0];
            const url = `${baseUrl}?peer=${myId}`;
            new QRious({ element: els.qrCanvas, value: url, size: 200, backgroundAlpha: 0, foreground: '#0f172a' });
        }
        function toggleQR() { els.qrContainer.classList.toggle('hidden'); }
        function addFileBubble(name, size, type, url) {
            const isSent = type === 'sent';
            const div = document.createElement('div');
            div.className = `flex ${isSent ? 'justify-end' : 'justify-start'} animate-fade-in`;
            div.innerHTML = `
                <div class="${isSent ? 'bg-blue-600' : 'bg-slate-800'} p-4 rounded-2xl max-w-[85%] border border-slate-600 shadow-xl">
                    <div class="flex items-center gap-4">
                        <div class="bg-black/20 w-10 h-10 flex items-center justify-center rounded-xl shrink-0 text-white"><i class="fa-solid ${isSent ? 'fa-arrow-up' : 'fa-arrow-down'}"></i></div>
                        <div class="overflow-hidden min-w-0">
                            <p class="font-bold text-white text-sm truncate">${name}</p>
                            <p class="text-[10px] text-gray-300 mt-0.5">${formatBytes(size)}</p>
                        </div>
                    </div>
                    ${url ? `<a href="${url}" download="${name}" class="mt-3 block w-full bg-slate-700 hover:bg-slate-600 text-center py-2.5 rounded-xl text-xs font-bold text-white transition">Save to Device</a>` : ''}
                </div>`;
            els.fileList.appendChild(div);
            els.fileList.scrollTop = els.fileList.scrollHeight;
        }
        function resetUI() {
            conn = null;
            resetTransferUI();
            els.emptyState.classList.remove('hidden');
            els.fileList.classList.add('hidden');
            els.actionBar.classList.add('hidden');
            els.waitingScreen.classList.add('hidden');
            els.fileList.innerHTML = '';
        }
        function formatBytes(b) { if(!b) return '0B'; const k=1024, i=Math.floor(Math.log(b)/Math.log(k)); return parseFloat((b/Math.pow(k,i)).toFixed(1)) + ['B','KB','MB','GB'][i]; }
        
        function copyId() {
            const textArea = document.createElement("textarea");
            textArea.value = myId;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try { document.execCommand('copy'); showToast("ID Copied", "success"); } catch (err) { showToast("Copy failed", "error"); }
            document.body.removeChild(textArea);
        }
        function setupDragDrop() {
            window.addEventListener('dragenter', () => els.dropZone.classList.remove('hidden'));
            els.dropZone.addEventListener('dragleave', () => els.dropZone.classList.add('hidden'));
            els.dropZone.addEventListener('dragover', e => e.preventDefault());
            els.dropZone.addEventListener('drop', e => { e.preventDefault(); els.dropZone.classList.add('hidden'); handleFiles(e.dataTransfer.files); });
        }
    </script>
</body>
</html>
